import SelectionTabs from "components/routing/SelectionTabs";
import React, { useEffect, useState } from "react";
import {
  Toolbar,
  ToolSeparator,
  ButtonTool,
  SelectTool,
  ModalTool,
} from "./Toolbar/Toolbar";
import { TbX, TbSearch, TbHome } from "react-icons/tb";
import { useStocksData } from "contexts/StocksDataContext";
import CandlestickAndIndicatorsChart from "./CandlestickAndIndicatorsChart";
import { CustomCard } from "components/utils/cards/CustomCard";
import { useNavigate } from "react-router-dom";

const AdvancedChart = ({ symbol }) => {
  const navigate = useNavigate();

  const tabs = [
    {
      id: 1,
      name: "معلومات السهم",
      to: ``,
    },
    { id: 2, name: "Tab 2", to: "" },
    { id: 3, name: "Tab 3", to: "" },
    { id: 4, name: "Tab 4", to: `` },
  ];
  const [stockPriceData, setStockPriceData] = useState();
  const [selectedIndicators, setSelectedIndicators] = useState();
  const { getStockPriceData, getIndicatorData } = useStocksData();
  // Dummy data for the select options
  useEffect(() => {
    const fetchStockData = async () => {
      try {
        if (symbol) {
          const indicators = [
            {
              name: "macd",

              pane: 1,
              lines: [
                {
                  vas: await getIndicatorData(symbol, "vsa"),
                  color: "#BF5733", // Color for macd indicator
                },
                {
                  ema_21: {
                    "2022-01-02": 0,
                    "2022-01-03": 0,
                    "2022-01-04": 0,
                    "2022-01-05": 0,
                    "2022-01-06": 0,
                    "2022-01-09": 0,
                    "2022-01-10": 0,
                    "2022-01-11": 0,
                    "2022-01-12": 0,
                    "2022-01-13": 0,
                    "2022-01-16": 0,
                    "2022-01-17": 0,
                    "2022-01-18": 0,
                    "2022-01-19": 0,
                    "2022-01-20": 0,
                    "2022-01-23": 0,
                    "2022-01-24": 0,
                    "2022-01-25": 0,
                    "2022-01-26": 0,
                    "2022-01-27": 0,
                    "2022-01-30": -0.234729893,
                    "2022-01-31": -0.4224888448,
                    "2022-02-01": -0.0167932242,
                    "2022-02-02": 0.6774389999,
                    "2022-02-03": -0.1282801409,
                    "2022-02-06": -0.1202645641,
                    "2022-02-07": 0.0597549048,
                    "2022-02-08": 0.0983614733,
                    "2022-02-09": 0.0756499084,
                    "2022-02-10": 0.1466628683,
                    "2022-02-13": 0.1348787059,
                    "2022-02-14": -0.1216341948,
                    "2022-02-15": -0.618691458,
                    "2022-02-16": -0.0563601862,
                    "2022-02-17": -0.251104128,
                    "2022-02-20": -0.24197788,
                    "2022-02-21": 0.0891312642,
                    "2022-02-23": -0.4047509557,
                    "2022-02-24": -0.3491470795,
                    "2022-02-27": 0.0868988668,
                    "2022-02-28": -0.0535695287,
                    "2022-03-01": 0.0176044083,
                    "2022-03-02": 0.5490866112,
                    "2022-03-03": 0.5144877592,
                    "2022-03-06": -0.1252721218,
                    "2022-03-07": 0.2415907193,
                    "2022-03-08": 0.5674145663,
                    "2022-03-09": 0.3480856625,
                    "2022-03-10": 0.2485828427,
                    "2022-03-13": 0.1389846916,
                    "2022-03-14": -0.3518737573,
                    "2022-03-15": -0.3576971392,
                    "2022-03-16": 0.390236795,
                    "2022-03-17": -0.0631932404,
                    "2022-03-20": -0.2811102751,
                    "2022-03-21": -0.382539605,
                    "2022-03-22": -0.2811845151,
                    "2022-03-23": 0.0277003959,
                    "2022-03-24": -0.0265162945,
                    "2022-03-27": -0.0745001471,
                    "2022-03-28": -0.1800015858,
                    "2022-03-29": -0.2279400595,
                    "2022-03-30": 0.2159615093,
                    "2022-03-31": 0.1879046956,
                    "2022-04-03": -0.2725729183,
                    "2022-04-04": 0.0478231088,
                    "2022-04-05": -0.3749885077,
                    "2022-04-06": -0.5255892903,
                    "2022-04-07": -0.2200080099,
                    "2022-04-10": -0.1630075102,
                    "2022-04-11": -0.188093426,
                    "2022-04-12": -0.1495672942,
                    "2022-04-13": 0.0606102933,
                    "2022-04-14": 0.2532220607,
                    "2022-04-17": -0.0367540401,
                    "2022-04-18": 0.1183799956,
                    "2022-04-19": 0.0260144073,
                    "2022-04-20": -0.24294144,
                    "2022-04-21": 0.2014948608,
                    "2022-04-24": -0.1072017028,
                    "2022-04-25": -0.1758784389,
                    "2022-04-26": 0.1250748577,
                    "2022-04-27": 0.790385983,
                    "2022-04-28": -0.4140915431,
                    "2022-05-08": 0.824075271,
                    "2022-05-09": -0.0510713501,
                    "2022-05-10": 0.5200601618,
                    "2022-05-11": 0.1907776618,
                    "2022-05-12": 0.9048007299,
                    "2022-05-15": 1.1826925223,
                    "2022-05-16": -0.0991073045,
                    "2022-05-17": 0.4381948245,
                    "2022-05-18": -0.7340292705,
                    "2022-05-19": -0.3316436555,
                    "2022-05-22": 0.3924606338,
                    "2022-05-23": -0.2410872879,
                    "2022-05-24": -0.288149769,
                    "2022-05-25": 0.078904748,
                    "2022-05-26": -0.0785718322,
                    "2022-05-29": -0.7202173809,
                    "2022-05-30": -0.6719646686,
                    "2022-05-31": 0,
                    "2022-06-01": 0,
                    "2022-06-02": 0,
                    "2022-06-05": 0,
                    "2022-06-06": 0,
                    "2022-06-07": 0,
                    "2022-06-08": -0.0635831609,
                    "2022-06-09": 0.2058722314,
                    "2022-06-12": 0.4308250946,
                    "2022-06-13": 0.6285506635,
                    "2022-06-14": 0.1280271355,
                    "2022-06-15": -0.0293682695,
                    "2022-06-16": -0.5379497925,
                    "2022-06-19": 0.1592605578,
                    "2022-06-20": -0.0474632065,
                    "2022-06-21": 0.0195955065,
                    "2022-06-22": -0.0359775946,
                    "2022-06-23": -0.1129916917,
                    "2022-06-26": -0.1690427621,
                    "2022-06-27": -0.1596386696,
                    "2022-06-28": 0.6373041537,
                    "2022-06-29": 0.4144037081,
                    "2022-06-30": -0.5957764109,
                    "2022-07-03": 0.2003112518,
                    "2022-07-04": -0.0212834368,
                    "2022-07-05": -0.1366033707,
                    "2022-07-06": -0.3712560037,
                    "2022-07-13": 0.0960718783,
                    "2022-07-14": 0.187930429,
                    "2022-07-17": 0,
                    "2022-07-18": 0.757577399,
                    "2022-07-19": 0.1271800179,
                    "2022-07-20": -0.331174035,
                    "2022-07-21": -0.3283170652,
                    "2022-07-24": 0.0386186613,
                    "2022-07-25": -0.2235882012,
                    "2022-07-26": -0.2308898111,
                    "2022-07-27": -0.1387533528,
                    "2022-07-28": 0,
                    "2022-07-31": 0,
                    "2022-08-01": 0,
                    "2022-08-02": 0,
                    "2022-08-03": -0.1156388634,
                    "2022-08-04": -0.2443566907,
                    "2022-08-07": 0.0461617588,
                    "2022-08-08": 0.0261818523,
                    "2022-08-09": 0,
                    "2022-08-10": 0,
                    "2022-08-11": 0.4832444155,
                    "2022-08-14": 0.279303541,
                    "2022-08-15": 0.0364372854,
                    "2022-08-16": -0.0797654106,
                    "2022-08-17": -0.0926626311,
                    "2022-08-18": 0.0013366557,
                    "2022-08-21": 0.2069929257,
                    "2022-08-22": -0.0830679861,
                    "2022-08-23": 0.2001108238,
                    "2022-08-24": 0.5214315048,
                    "2022-08-25": -0.1698372299,
                    "2022-08-28": 0.1453138522,
                    "2022-08-29": -0.1686728371,
                    "2022-08-30": -0.0734422456,
                    "2022-08-31": -0.0985703959,
                    "2022-09-01": -0.099850474,
                    "2022-09-04": 0.1241548248,
                    "2022-09-05": -0.5077711883,
                    "2022-09-06": 0.0624290433,
                    "2022-09-07": -0.0682685786,
                    "2022-09-08": -0.0900594519,
                    "2022-09-11": 0.0042638485,
                    "2022-09-12": -0.1425471887,
                    "2022-09-13": -0.409880779,
                    "2022-09-14": 0.1952148358,
                    "2022-09-15": 0.0835194025,
                    "2022-09-18": 0.3550282348,
                    "2022-09-19": -0.199115649,
                    "2022-09-20": -0.2498965896,
                    "2022-09-21": -0.2508585504,
                    "2022-09-25": -0.046009513,
                    "2022-09-26": -0.1315302931,
                    "2022-09-27": -0.2308994534,
                    "2022-09-28": 0.510175082,
                    "2022-09-29": 0.0869609029,
                    "2022-10-02": 0.1751644301,
                    "2022-10-03": 0.1479955141,
                    "2022-10-04": -0.1980255447,
                    "2022-10-05": 0.1717022879,
                    "2022-10-06": -0.2282611612,
                    "2022-10-09": -0.0694914396,
                    "2022-10-10": 0.063512733,
                    "2022-10-11": -0.2272003706,
                    "2022-10-12": -0.1046957558,
                    "2022-10-13": -0.0889402485,
                    "2022-10-16": 0.5164356012,
                    "2022-10-17": -0.2291670485,
                    "2022-10-18": -0.1721438128,
                    "2022-10-19": 0.0523336256,
                    "2022-10-20": -0.1109998487,
                    "2022-10-23": 0.507369481,
                    "2022-10-24": 0,
                    "2022-10-25": 0,
                    "2022-10-26": 0,
                    "2022-10-27": 0,
                    "2022-10-30": 0,
                    "2022-10-31": -0.5851757306,
                    "2022-11-01": 0.1876428513,
                    "2022-11-02": 0.124142399,
                    "2022-11-03": -0.3893380972,
                    "2022-11-06": -0.2096682684,
                    "2022-11-07": -0.3956445517,
                    "2022-11-08": -0.2025714225,
                    "2022-11-09": 0.0664948542,
                    "2022-11-10": -0.1710383238,
                    "2022-11-13": 0.3288511039,
                    "2022-11-14": -0.2058784512,
                    "2022-11-15": 0.5658304663,
                    "2022-11-16": 0.6941767885,
                    "2022-11-17": -0.1200106182,
                    "2022-11-20": -0.1626984752,
                    "2022-11-21": 0.281937254,
                    "2022-11-22": 0.2354728591,
                    "2022-11-24": -0.1471250763,
                    "2022-11-27": -0.3719148641,
                    "2022-11-28": 0.0294224212,
                    "2022-11-29": -0.3121496811,
                    "2022-11-30": -0.0599100455,
                    "2022-12-01": -0.0448788035,
                    "2022-12-04": -0.0473731835,
                    "2022-12-05": 0.078318771,
                    "2022-12-06": -0.3873359163,
                    "2022-12-07": 0.023534245,
                    "2022-12-08": 0.4821988524,
                    "2022-12-11": 0.5472242243,
                    "2022-12-12": 0.1279057534,
                    "2022-12-13": 0.0431713898,
                    "2022-12-14": -0.0211225842,
                    "2022-12-15": 0,
                    "2022-12-18": 0,
                    "2022-12-19": 0,
                    "2022-12-20": 0,
                    "2022-12-21": 0,
                    "2022-12-22": 0,
                    "2022-12-25": 0,
                    "2022-12-26": 0,
                    "2022-12-27": 0,
                    "2022-12-28": 0,
                    "2022-12-29": -0.5324565522,
                    "2023-01-01": 0.1282084719,
                    "2023-01-02": -0.0960039495,
                    "2023-01-03": -0.2124268362,
                    "2023-01-04": 0.4705777713,
                    "2023-01-05": 0.2648552026,
                    "2023-01-08": -0.1030110404,
                    "2023-01-09": 0.0787405709,
                    "2023-01-10": -0.2610883931,
                    "2023-01-11": -0.0189042523,
                    "2023-01-12": 0.0812924778,
                    "2023-01-15": 0.0114243318,
                    "2023-01-16": -0.0967374752,
                    "2023-01-17": 0.17836323,
                    "2023-01-18": 0.0666486927,
                    "2023-01-19": -0.0821128188,
                    "2023-01-22": -0.0478958462,
                    "2023-01-23": -0.1035238404,
                    "2023-01-24": -0.4485837415,
                    "2023-01-25": 1.1979713548,
                    "2023-01-26": -0.3867128469,
                    "2023-01-29": -0.1267526453,
                    "2023-01-30": -0.3076972621,
                    "2023-01-31": 0.0047538398,
                    "2023-02-01": 0.3068019679,
                    "2023-02-02": 0.2884399791,
                    "2023-02-05": 0.7070785931,
                    "2023-02-06": -0.0197712417,
                    "2023-02-07": -0.357612072,
                    "2023-02-08": 0,
                    "2023-02-09": 0,
                    "2023-02-12": -0.484144219,
                    "2023-02-13": 0.3204177739,
                    "2023-02-14": -0.2912437696,
                    "2023-02-15": 0.3136610596,
                    "2023-02-16": -0.0858954961,
                    "2023-02-19": 0.3699987647,
                    "2023-02-20": 0.2099317764,
                    "2023-02-21": -0.0796944771,
                    "2023-02-23": 0.2202831862,
                    "2023-02-26": 0.2648085636,
                    "2023-02-27": -0.2155607808,
                    "2023-02-28": 0.2526636195,
                    "2023-03-01": 0.0934239172,
                    "2023-03-02": -0.0048863911,
                    "2023-03-05": 0.2125540772,
                    "2023-03-06": -0.5121451473,
                    "2023-03-07": -0.4159241064,
                    "2023-03-08": 0.7320557857,
                    "2023-03-09": -0.4802764042,
                    "2023-03-12": -0.0562775647,
                    "2023-03-13": -0.3930969638,
                    "2023-03-14": -0.0999271797,
                    "2023-03-15": 1.0050335184,
                    "2023-03-16": 0.1209393585,
                    "2023-03-19": -0.4089304553,
                    "2023-03-20": -0.2076319736,
                    "2023-03-21": 0.275606304,
                    "2023-03-22": 0.5987282486,
                    "2023-03-23": 0.1167592005,
                    "2023-03-26": -0.4711132776,
                    "2023-03-27": -0.4711132776,
                    "2023-03-28": -0.3224389768,
                    "2023-03-29": -0.503852082,
                    "2023-03-30": -0.1294566853,
                    "2023-04-02": -0.3780065648,
                    "2023-04-03": 0.4749237337,
                    "2023-04-04": 0.4670887474,
                    "2023-04-05": 0.8316208283,
                    "2023-04-06": -0.4073784472,
                    "2023-04-09": 0.2179991287,
                    "2023-04-10": 0.0101132278,
                    "2023-04-11": 0,
                    "2023-04-12": 0,
                    "2023-04-13": 0,
                    "2023-04-16": 0,
                    "2023-04-17": 0,
                    "2023-04-25": 0,
                    "2023-04-26": 0,
                    "2023-04-27": -0.3970346949,
                    "2023-04-30": -1.0206789684,
                    "2023-05-01": -0.9098051456,
                    "2023-05-02": 0.3399350863,
                    "2023-05-03": -0.7227283208,
                    "2023-05-04": 0,
                    "2023-05-07": 0,
                    "2023-05-08": -0.5519445686,
                    "2023-05-09": 1.0615954766,
                    "2023-05-10": -0.3156546462,
                    "2023-05-11": 0.245648059,
                    "2023-05-14": 0,
                    "2023-05-15": 0,
                    "2023-05-16": 0,
                    "2023-05-17": 0,
                    "2023-05-18": 0,
                    "2023-05-21": 0,
                    "2023-05-22": -0.5359137626,
                    "2023-05-23": 0,
                    "2023-05-24": 0,
                    "2023-05-25": 0,
                    "2023-05-28": 0,
                    "2023-05-29": 0,
                    "2023-05-30": -0.0360309487,
                    "2023-05-31": 0.489148924,
                    "2023-06-01": 0.0344761589,
                    "2023-06-04": 0.2945987257,
                    "2023-06-05": 0,
                    "2023-06-06": 0,
                    "2023-06-07": 0,
                    "2023-06-08": 0,
                    "2023-06-11": 0,
                    "2023-06-12": 0,
                    "2023-06-13": 0,
                    "2023-06-14": 0,
                    "2023-06-15": 0,
                    "2023-06-18": 0,
                    "2023-06-19": 0,
                    "2023-06-20": 0,
                    "2023-06-21": 0,
                    "2023-06-22": 0,
                    "2023-07-02": 0,
                    "2023-07-03": 0,
                    "2023-07-04": 0,
                    "2023-07-05": 0,
                    "2023-07-06": 0,
                    "2023-07-09": 0,
                    "2023-07-10": 0,
                    "2023-07-11": 0.102605462,
                    "2023-07-12": 0.2726459252,
                    "2023-07-13": 0,
                    "2023-07-16": 0,
                    "2023-07-17": -0.0017053775,
                    "2023-07-18": 0.1746138572,
                    "2023-07-19": 0.4158936,
                    "2023-07-20": 0.3700509988,
                    "2023-07-23": 0.4371807517,
                    "2023-07-24": -0.1429244616,
                    "2023-07-25": -0.0951801458,
                    "2023-07-26": 0.4743214512,
                    "2023-07-27": -0.0286687274,
                    "2023-07-30": 0.0492874968,
                    "2023-07-31": -0.0136188443,
                    "2023-08-01": 0.1173578928,
                    "2023-08-02": -0.1680299464,
                    "2023-08-03": 0.0999516093,
                    "2023-08-06": -0.2782550582,
                    "2023-08-07": 0.4775347859,
                    "2023-08-08": 0.5633974961,
                    "2023-08-09": 0.1909561564,
                    "2023-08-10": -0.1463057166,
                    "2023-08-13": -0.0283324083,
                    "2023-08-14": -0.1431404969,
                    "2023-08-15": 0.2028388029,
                    "2023-08-16": 0.28338339,
                    "2023-08-17": 0.1775362095,
                    "2023-08-20": -0.0641567905,
                    "2023-08-21": 0.0483888994,
                    "2023-08-22": -0.473725614,
                    "2023-08-23": 0.1092222556,
                    "2023-08-24": 0.1321851853,
                    "2023-08-27": -0.3147240889,
                    "2023-08-28": 0.055445124,
                    "2023-08-29": -0.0789985967,
                    "2023-08-30": 0.4877134858,
                    "2023-08-31": 0,
                    "2023-09-03": 0,
                    "2023-09-04": 0,
                    "2023-09-05": 0,
                    "2023-09-06": -0.331062179,
                    "2023-09-07": 0.153255747,
                    "2023-09-10": -0.0355075964,
                    "2023-09-11": 0.1364241777,
                    "2023-09-12": 0.1710208086,
                    "2023-09-13": -0.050271684,
                    "2023-09-14": -0.2817889842,
                    "2023-09-17": 0.1020685495,
                    "2023-09-18": -0.0970689332,
                    "2023-09-19": -0.2587698981,
                    "2023-09-20": -0.0946963431,
                    "2023-09-21": 0.2432419002,
                    "2023-09-25": 0,
                    "2023-09-26": 0,
                    "2023-09-27": 0,
                    "2023-09-28": 0,
                    "2023-10-01": -0.5803137382,
                    "2023-10-02": 0.3169195049,
                    "2023-10-03": -0.2878056997,
                    "2023-10-04": 0.0295573118,
                    "2023-10-05": -0.1826118411,
                    "2023-10-08": 0.1226837161,
                    "2023-10-09": 0.0020648407,
                    "2023-10-10": 0.3714461255,
                    "2023-10-11": 0.3859739927,
                    "2023-10-12": 0.0917410082,
                    "2023-10-15": 0,
                    "2023-10-16": 0,
                    "2023-10-17": 0,
                    "2023-10-18": 0,
                    "2023-10-19": 0,
                    "2023-10-22": 0,
                    "2023-10-23": 0,
                    "2023-10-24": 0,
                    "2023-10-25": 0.2325863242,
                    "2023-10-26": 0.3461131327,
                    "2023-10-29": -0.1741464515,
                    "2023-10-30": 0.0014467933,
                    "2023-10-31": -0.028397109,
                    "2023-11-01": -0.0459401841,
                    "2023-11-02": -0.0288933627,
                    "2023-11-05": 0.0463018961,
                    "2023-11-06": 100,
                    "2023-11-07": 100,
                    "2023-11-08": 100,
                    "2023-11-09": 100,
                    "2023-11-12": 100,
                    "2023-11-13": 100,
                  },
                  color: "#000", // Color for macd indicator
                },
              ],
            },
            {
              name: "vsa",
              pane: 2,
              lines: [
                {
                  vas: await getIndicatorData(symbol, "vsa"),
                  color: "#000", // Color for macd indicator
                },
              ],
            },
          ];
          setStockPriceData(await getStockPriceData(symbol));
          setSelectedIndicators(indicators);
          console.log(await getIndicatorData(symbol, "vsa"));
        }
      } catch (error) {
        // Handle any errors if the promise rejects
        console.error("Error fetching data:", error);
      }
    };

    fetchStockData();
  }, [symbol]);
  return (
    <div className="d-flex flex-column" style={{ height: "100vh" }}>
      <Toolbar>
        <ButtonTool
          icon={TbHome}
          hoverText="Home"
          onClick={() => {
            console.log("hi");
            navigate("/");
          }}
        />
        <ToolSeparator />

        <ButtonTool
          icon={TbX}
          hoverText="Tool 1"
          onClick={() => console.log("Tool 1 clicked")}
        />
        <ToolSeparator />
        <ModalTool
          icon={TbSearch}
          hoverText="Modal"
          text={symbol}
          title={"Search"}
        >
          <div> aksdkadlsdksdlak</div>
        </ModalTool>
        <ToolSeparator />

        <SelectTool
          options={[
            { value: "ny", label: "New York" },
            { value: "ca", label: "California" },
            { value: "tx", label: "Texas" },
          ]}
        />
      </Toolbar>
      <div id="responsive-chart" className="h-100">
        <CandlestickAndIndicatorsChart
          series={stockPriceData}
          indcators={selectedIndicators}
          symbol={symbol}
        />
      </div>

      {/* <SelectionTabs tabs={tabs} /> */}
    </div>
  );
};

export default AdvancedChart;
